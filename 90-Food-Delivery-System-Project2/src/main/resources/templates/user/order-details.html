<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">

<title>Order Details | FoodExec</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com" rel="stylesheet">

<style>
body {
font-family: 'Outfit', sans-serif;
background: linear-gradient(135deg, #fff5f7 0%, #f0f4ff 100%);
min-height: 100vh;
}

.glass-card {
background: rgba(255, 255, 255, 0.8);
backdrop-filter: blur(16px);
border: 1px solid rgba(255, 255, 255, 0.5);
}
</style>
</head>
<body class="p-6">

<div class="max-w-3xl mx-auto">
<a th:href="@{/user/orders/my-orders}"
class="text-rose-500 font-bold mb-8 inline-block hover:underline">← Back to Orders</a>

<div th:if="${order != null}"
class="glass-card rounded-[2.5rem] p-10 shadow-xl">
<h2 class="text-3xl font-black text-slate-900 mb-6"
th:text="|Order #${order.orderId}|">#000</h2>

<div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
<div>
<p class="text-xs font-black uppercase text-slate-400">Order Status</p>
<p class="text-lg font-bold text-rose-500"
th:text="${order.orderStatus ?: 'PLACED'}"></p>

<!-- Delivery Agent -->
<div class="mt-6">
<p class="text-xs font-black uppercase text-slate-400">Delivery Agent</p>
<p class="text-lg font-bold text-slate-700"
th:if="${order.deliveryAgentName != null}"
th:text="${order.deliveryAgentName}"></p>
<p class="text-sm text-slate-500"
th:if="${order.deliveryAgentPhone != null}"
th:text="${'Phone: ' + order.deliveryAgentPhone}"></p>
<p class="text-lg font-bold text-slate-300"
th:if="${order.deliveryAgentName == null}">Not Assigned</p>
</div>
</div>

<div class="md:text-right">
<p class="text-xs font-black uppercase text-slate-400">Placed On</p>
<p class="font-bold text-slate-700"
th:text="${order.orderDate != null ? #temporals.format(order.orderDate, 'dd MMM yyyy, hh:mm a') : 'N/A'}"></p>
</div>
</div>

<div class="border-t border-slate-200 pt-8">

<!-- ✨ ITEMS SUMMARY SECTION ✨ -->
<h3 class="font-black text-slate-800 mb-6 uppercase text-sm">Items Summary</h3>

<!-- Items with Quantity and Price Calculation -->
<div th:if="${order.itemDetails != null and order.itemDetails.size() > 0}" class="space-y-4 mb-8">
<div th:each="entry : ${order.itemDetails}" class="flex justify-between items-center bg-gradient-to-r from-white/60 to-orange-50/40 p-5 rounded-2xl border border-orange-100/50 hover:border-orange-200 transition-all">
<div class="flex-1">

<!-- Item Name -->
<p class="text-base font-bold text-slate-800" th:text="${entry.key}">Pizza Margherita</p>
<!-- Quantity Badge -->
<p class="text-sm text-slate-500 mt-1">
Qty: <span class="font-bold text-orange-600" th:text="${entry.value.quantity}">2</span>
</p>
</div>

<!-- Price Section with Calculation -->
<div class="text-right">
<p class="text-xs font-semibold text-slate-400 mb-1">Unit Price</p>
<p class="text-lg font-bold text-slate-700 mb-3">
₹<span th:text="${#numbers.formatDecimal(entry.value.price, 0, 2)}">240.00</span>
</p>

<!-- CALCULATION DISPLAY -->
<p class="text-xs text-slate-500 mb-2">
<span th:text="${entry.value.quantity}">2</span> × ₹<span th:text="${#numbers.formatDecimal(entry.value.price, 0, 2)}">240.00</span>
</p>

<div class="pt-3 border-t border-orange-200">
<p class="text-xs font-semibold text-slate-400">Subtotal</p>
<p class="text-xl font-black text-rose-500">
₹<span th:text="${#numbers.formatDecimal(entry.value.subtotal, 0, 2)}">480.00</span>
</p>
</div>
</div>
</div>
</div>

<!-- Fallback for older orders without itemDetails -->
<div th:if="${order.itemDetails == null or order.itemDetails.size() == 0}" class="space-y-3 mb-8">
<div th:each="itemId : ${order.itemIds}" class="flex justify-between items-center bg-white/60 p-4 rounded-xl border border-white">
<span class="text-slate-600 font-medium" th:text="|Product ID: ${itemId}|"></span>
<span class="text-slate-400 text-xs">Qty: 1</span>
</div>
</div>

<!-- CHARGES SUMMARY -->
<div class="bg-slate-50 rounded-2xl p-6 space-y-3 mb-8">
<h4 class="font-bold text-slate-800 mb-4">Order Summary</h4>

<!-- Subtotal -->
<div class="flex justify-between items-center">
<p class="text-slate-600 font-medium">Subtotal</p>
<p class="text-slate-700 font-bold">
₹<span th:text="${#numbers.formatDecimal(order.totalAmount - 20, 0, 2)}">0</span>
</p>
</div>

<!-- Delivery Fee -->
<div class="flex justify-between items-center border-b border-slate-200 pb-3">
<div>
<p class="text-slate-600 font-medium">Delivery Fee</p>
<p class="text-xs text-slate-400">Standard Delivery</p>
</div>
<p class="text-slate-700 font-bold">₹20.00</p>
</div>

<!-- Total -->
<div class="flex justify-between items-center pt-3">
<p class="text-lg font-black text-slate-900">Total Amount</p>
<p class="text-2xl font-black text-rose-500">
₹<span th:text="${#numbers.formatDecimal(order.totalAmount, 0, 2)}">0</span>
</p>
</div>

</div>
</div>
</div>
</div>
</body>
</html>
